<!DOCTYPE html>
<html lang="en">
<head>
<title>THREE.SimpleDatGui Oculus Rift Demo</title>
<meta charset="utf-8">
<style>
body {
	margin: 0px;
	background-color: #000;
	overflow: hidden;
}

.absoluteTitle {
	position: absolute;
	top: 0px;
	left: 0px;
	color: #FFAA00;
	font-family: Arial;
	font-size: 10pt;
	text-align: center;
}
</style>
</head>
<body>
<div class="absoluteTitle">THREE.SimpleDatGuiOculusRiftDemo.html - click right mouse button to toggle GUI and run OculusRiftSensorConnector.jar on local machine to get Oculus Rift sensor data. Fork source code on <a href="https://github.com/MarkusSprunck/oculus-rift-sensor-connector/tree/master/oculus-rift-sensor-connector">GitHub</a>.
</div>
<script src="./lib/three.min.js"></script>
<script src="./lib/TrackballControls.js"></script>
<script src="./lib/stats.min.js"></script>
<script src="./lib/AxisHelper.js"></script>
<script src="./lib/helvetiker_regular.typeface.js"></script>
<script src="./lib/OculusRiftEffect.js"></script>
<script src="./THREE.SimpleDatGui.js"></script>
<script src="./THREE.OculusRiftMouse.js"></script>
<script src="./THREE.OculusRiftControls.js"></script>
<script>
    var skydome, video, texture, controlOculus, effect, camera, scene, renderer, mesh, gui, trackbarControl, container, hemiLight, oculusRiftMousePointerHelper;

    function myOptionsDefinition() {
        "use strict";
        return {
                    USE_OCULUS_CONTROL: false,
                    FIXED_POSITION: false,
                    TRANPARENT: true,
                    OPACITY: 60,
                    TEXTURE_FILE: 'Place de la Concorde Paris',
                    TEXTURE_FILE_RESOLUTION: 'medium',
                    ROTATION_SPEED: 0.5,
                    ROTATION_ANGLE: Math.PI / 2 * 3,
                    ROTATION_AUTOMATIC: false,
        };
    }
    var myOptions = myOptionsDefinition();

    var sceneDistance = 50;
    var gui_width = 280;
    var gui_scale = 1.5;

    init();

    animate();

    function init() {
        "use strict";

        // camera

        camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 1, 4000);
        camera.applyMatrix(new THREE.Matrix4().makeTranslation(0, 0, sceneDistance));
        camera.lookAt(new THREE.Vector3(0, 0, 0));

        // scene 

        scene = new THREE.Scene();
        scene.add(camera);

        // skydome

        createSkyDome();

        // renderer

        renderer = new THREE.WebGLRenderer({
            antialias: true
        });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.gammaInput = true;
        renderer.gammaOutput = true;
        renderer.shadowMapEnabled = false;
        document.body.appendChild(renderer.domElement);

        // oculus rift effect

        effect = new THREE.OculusRiftEffect(renderer);

        // oculus rift controls

        controlOculus = new THREE.OculusRiftRotationControls(camera, sceneDistance, new THREE.Vector3(0, 0, 0));

        // oculus rift mouse pointer

        oculusRiftMousePointerHelper = new THREE.OculusRiftMousePointerHelper({
                    camera: camera,
                    domElement: renderer.domElement
        });
        scene.add(oculusRiftMousePointerHelper);

        // gui

        var myFunctions = {
            RESET_EVENT: function() {
                trackbarControl.reset();
                camera.position.x = 0;
                camera.position.y = 0;
                camera.position.z = sceneDistance;
                camera.rotation.x = 0;
                camera.rotation.y = 0;
                camera.rotation.z = 0;
                camera.lookAt(new THREE.Vector3(0, 0, 0));
            }
        };

        trackbarControl = new THREE.TrackballControls(camera, renderer.domElement);
        trackbarControl.noZoom = true;

        gui = new THREE.SimpleDatGui({
                    scene: scene,
                    camera: camera,
                    renderer: renderer,
                    width: gui_width,
                    scale: gui_scale,
                    position: new THREE.Vector3(-gui_width * gui_scale / 2, 150, -400),
                    automatic: !myOptions.FIXED_POSITION
        });

        gui.add(myFunctions, 'RESET_EVENT').name('Reset Position');
        gui.add(myOptions, 'TRANPARENT').name('Tranparent').onChange(function(value) {
            myOptions.OPACITY = (value) ? 60 : 100;
        });
        gui.add(myOptions, 'FIXED_POSITION').name('Fixed').onChange(function(value) {
            gui.setAutomatic(!myOptions.FIXED_POSITION);
        });
        gui.add(myOptions, 'USE_OCULUS_CONTROL').name('Use Oculus Control').onChange(function(value) {
            if (!value) {
                myFunctions.RESET_EVENT();
            }
        });
        gui.add(myOptions, 'TEXTURE_FILE',
                    ['Place de la Concorde Paris', 'Place Dauphine Paris', 'Parc de Belleville Paris']).name('Scene')
                    .onChange(function(value) {
                        createSkyDome();
                    });
        gui.add(myOptions, 'TEXTURE_FILE_RESOLUTION', ['high', 'medium', 'low']).name('Resolution').onChange(
                    function(value) {
                        createSkyDome();
                    });

        var folder1 = gui.addFolder("Advanced Options");
        folder1.add(myOptions, 'OPACITY', 10, 100).step(10).name('Opacity').onChange(function(value) {
            myOptions.TRANPARENT = !(value == 100);
        });
        folder1.add(myOptions, 'ROTATION_SPEED', -5, 5).step(0.5).name('Rotation Speed');
        folder1.add(myOptions, 'ROTATION_ANGLE', 0, Math.PI * 2).step(0.1).name('Rotation Position').onChange(
                    function(value) {
                        skydome.rotation.y = myOptions.ROTATION_ANGLE;
                    });
        folder1.add(myOptions, 'ROTATION_AUTOMATIC').name('Automatic Rotation');
        // folder1.open();

        // event listeners

        window.addEventListener('resize', onWindowResize, false);

        renderer.domElement.addEventListener('mousedown', function(event) {
            if (event.which == 3) {
                if (gui.isHidden()) {
                    gui.show();
                } else {
                    gui.hide();
                }
            }
        });

        onWindowResize();

        controlOculus.importData();

        var updateTimerImport = setInterval(function() {
            if (myOptions.USE_OCULUS_CONTROL) {
                controlOculus.update();
            } else {
                trackbarControl.update();
            }
        }, 40);

    }

    function createSkyDome(texture) {
        scene.remove(skydome);

        skydome = new THREE.Mesh(new THREE.SphereGeometry(6000, 32, 32), new THREE.MeshBasicMaterial({
            map: THREE.ImageUtils.loadTexture('./textures/' + myOptions.TEXTURE_FILE_RESOLUTION + '/'
                        + myOptions.TEXTURE_FILE + '.jpg')
        }));

        skydome.scale.x = -1;
        skydome.rotation.y = myOptions.ROTATION_ANGLE;
        scene.add(skydome);
    }

    function onWindowResize() {
        "use strict";

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        effect.setSize(window.innerWidth, window.innerHeight);
    }

    function animate() {
        "use strict";

        requestAnimationFrame(animate);

        gui.setOpacity(myOptions.OPACITY);
        gui.update();
        oculusRiftMousePointerHelper.update();

        if (myOptions.ROTATION_AUTOMATIC) {
            skydome.rotation.y = (skydome.rotation.y + 0.001 * myOptions.ROTATION_SPEED) % (Math.PI * 2);
            myOptions.ROTATION_ANGLE = skydome.rotation.y;
        }

        effect.render(scene, camera);
    }
</script>
</body>
</html>
