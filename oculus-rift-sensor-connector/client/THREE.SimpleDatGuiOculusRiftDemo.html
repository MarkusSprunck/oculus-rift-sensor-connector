<!DOCTYPE html>
<html lang="en">
<head>
<title>THREE.SimpleDatGui Oculus Rift Demo</title>
<meta charset="utf-8">
<style>
body {
	margin: 0px;
	background-color: #000;
	overflow: hidden;
}

.absoluteTitle {
	position: absolute;
	top: 0px;
	left: 0px;
	color: #666;
	font-family: Arial;
	font-size: 15pt;
	text-align: center;
}
</style>
</head>
<body>
<div class="absoluteTitle">THREE.SimpleDatGuiOculusRiftDemo.html - click right mouse button to toggle GUI and run OculusRiftSensorConnector.jar on local machine to get Oculus Rift sensor data. Fork source code on <a href="https://github.com/MarkusSprunck/oculus-rift-sensor-connector/tree/master/oculus-rift-sensor-connector">GitHub</a>.
</div>
<script src="./lib/three.min.js"></script>
<script src="./lib/TrackballControls.js"></script>
<script src="./lib/stats.min.js"></script>
<script src="./lib/AxisHelper.js"></script>
<script src="./lib/gentilis_regular.typeface.js"></script>
<script src="./lib/optimer_regular.typeface.js"></script>
<script src="./lib/helvetiker_regular.typeface.js"></script>
<script src="./lib/OculusRiftEffect.js"></script>
<script src="./THREE.SimpleDatGui.js"></script>
<script src="./THREE.OculusRiftMouse.js"></script>
<script src="./THREE.OculusRiftControls.js"></script>
<script>
    var skydome, controlOculus, effect, camera, scene, renderer, mesh, gui, trackbarControl, container, hemiLight, oculusRiftMousePointerHelper;

    function myOptionsDefinition() {
        "use strict";
        return {
                    RENDER_TEXT: "",
                    TRANPARENT: false,
                    USE_OCULUS_CONTROL: false,
                    ROTATION_SPEED: 0.5,
                    ROTATION_ANGLE: 0.0,
                    FONT_SIZE: 100,
                    ROTATION_X_AXIS: false,
                    OPACITY: 100,
                    FONT_NAME: "Gentilis"
        };
    }
    var myOptions = myOptionsDefinition();

    var sceneDistance = 200;

    init();

    animate();

    function init() {
        "use strict";

        // camera

        camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 1, 4000);
        camera.applyMatrix(new THREE.Matrix4().makeTranslation(0, 0, sceneDistance));
        camera.lookAt(new THREE.Vector3(0,0, 0));

        // skydome

        skydome = new THREE.Mesh(new THREE.SphereGeometry(3000, 32, 32), new THREE.MeshBasicMaterial({
            map: THREE.ImageUtils.loadTexture('./textures/sky.jpg')
        }));
        skydome.scale.x = -1;

        // scene 

        scene = new THREE.Scene();
        scene.add(camera);
        scene.add(skydome);

        // renderer

        renderer = new THREE.WebGLRenderer({
            antialias: true
        });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.gammaInput = true;
        renderer.gammaOutput = true;
        renderer.shadowMapEnabled = false;
        document.body.appendChild(renderer.domElement);

        // oculus rift effect

        effect = new THREE.OculusRiftEffect(renderer);

        // oculus rift controls

        controlOculus = new THREE.OculusRiftRotationControls(camera, 200, new THREE.Vector3(0, 0, 0));

        // oculus rift mouse pointer

        oculusRiftMousePointerHelper = new THREE.OculusRiftMousePointerHelper({
                    camera: camera,
                    domElement: renderer.domElement
        });
        scene.add(oculusRiftMousePointerHelper);

        // gui

        var myFunctions = {
            RESET_EVENT: function() {
                trackbarControl.reset();
                camera.position.x = 0;
                camera.position.y = 0;
                camera.position.z = sceneDistance;
                camera.rotation.x = 0;
                camera.rotation.y = 0;
                camera.rotation.z = 0;
                camera.lookAt(new THREE.Vector3(0, 0, 0));
            }
        };

        trackbarControl = new THREE.TrackballControls(camera, renderer.domElement);
       // trackbarControl.noZoom = true;

        var gui_width = 280;
        var gui_scale = 1.5;
        gui = new THREE.SimpleDatGui({
                    scene: scene,
                    camera: camera,
                    renderer: renderer,
                    width: gui_width,
                    scale: gui_scale,
                    position: new THREE.Vector3(-gui_width * gui_scale / 2, 150, -400)
        });

        gui.add(myFunctions, 'RESET_EVENT').name('Reset Position');
        gui.add(myOptions, 'TRANPARENT').name('Tranparent').onChange(function(value) {
            myOptions.OPACITY = (value) ? 80 : 100;
        });
        gui.add(myOptions, 'USE_OCULUS_CONTROL').name('Use Oculus Control').onChange(function(value) {
            if (!value) {
                myFunctions.RESET_EVENT();
            }
        });

        gui.add(myOptions, 'OPACITY', 10, 100).step(10).name('Opacity').onChange(function(value) {
            myOptions.TRANPARENT = !(value == 100);
        });
        gui.add(myOptions, 'RENDER_TEXT').name('Render Text').onChange(function(value) {
            addOrUpdateRotatingText(scene, myOptions.RENDER_TEXT);
        });
        gui.add(myOptions, 'FONT_NAME', ['Helvetiker', 'Gentilis', 'Optimer']).name('Font Type').onChange(
                    function(value) {
                        console.log(myOptions.RENDER_TEXT);
                    });

        var folder1 = gui.addFolder("Advanced Options");
        folder1.add(myOptions, 'FONT_SIZE', {
                    Small: 50,
                    Medium: 100
        }).name('Font Size').onChange(function(value) {
            console.log(myOptions.RENDER_TEXT);
        });
        folder1.add(myOptions, 'ROTATION_SPEED', -5, 5).step(0.5).name('Rotation Speed');
        folder1.add(myOptions, 'ROTATION_ANGLE', 0, Math.PI * 2).step(0.1).name('Rotation Angle').onChange(
                    function(value) {
                        skydome.rotation.y = myOptions.ROTATION_ANGLE;
                    });
        folder1.add(myOptions, 'ROTATION_X_AXIS').name('Rotation Active');
        folder1.open();

        // event listeners

        window.addEventListener('resize', onWindowResize, false);

        renderer.domElement.addEventListener('mousedown', function(event) {
            if (event.which == 3) {
                if (gui.isHidden()) {
                    gui.show();
                } else {
                    gui.hide();
                }
            }
        });

        onWindowResize();

        controlOculus.importData();

        var updateTimerImport = setInterval(function() {
            if (myOptions.USE_OCULUS_CONTROL) {
                controlOculus.update();
            } else {
                trackbarControl.update();
            }
        }, 50);

    }

    function onWindowResize() {
        "use strict";

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        effect.setSize(window.innerWidth, window.innerHeight);
    }

    function animate() {
        "use strict";

        requestAnimationFrame(animate);

        gui.setOpacity(myOptions.OPACITY);
        gui.update();
        oculusRiftMousePointerHelper.update();

        if (myOptions.ROTATION_X_AXIS) {
            skydome.rotation.y = (skydome.rotation.y + 0.005 * myOptions.ROTATION_SPEED) % (Math.PI * 2);
            myOptions.ROTATION_ANGLE = skydome.rotation.x;
        }

        effect.render(scene, camera);
    }
</script>
</body>
</html>
